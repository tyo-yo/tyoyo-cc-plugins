# 攻撃者モデリング ⭐⭐⭐⭐⭐

**ID**: S06
**カテゴリ**: セキュリティ（高度）
**優先度**: Tier 2（推奨）
**信頼度基準**: 85-100点（HIGH RISKのみ）

---

## 参照元

- [trailofbits/skills](https://github.com/trailofbits/skills)
- [Differential Review: Adversarial Analysis](https://github.com/trailofbits/skills/blob/main/differential-review/differential-review.md)

---

## 概要

HIGH RISKの脆弱性に対して、具体的な攻撃者モデルを定義し、実際の攻撃シナリオを構築します。

従来の「脆弱性あり/なし」の二値判定ではなく、「誰が（WHO）」「何を目的に（WHAT）」「どこから（WHERE）」攻撃するかを明確にし、悪用可能性（EASY/MEDIUM/HARD）を評価します。これにより、リスクの優先順位付けと対策の具体化が可能になります。

---

## チェック内容

### 攻撃者モデルの定義（WHO）

攻撃者のタイプと能力を特定:

#### 外部攻撃者（Unauthenticated）
- **能力**: インターネットからアクセス可能
- **制約**: 認証情報なし、内部ネットワークアクセスなし
- **典型的な攻撃**: SQLインジェクション、XSS、CSRF、認証バイパス

#### 認証済みユーザー（Authenticated User）
- **能力**: 正当なアカウント所持、一部のAPIアクセス権
- **制約**: 一般ユーザー権限のみ
- **典型的な攻撃**: 権限昇格、IDOR、ビジネスロジック悪用

#### 内部脅威（Insider）
- **能力**: 内部ネットワークアクセス、一部のシステム知識
- **制約**: 管理者権限なし
- **典型的な攻撃**: データ漏洩、横方向移動、特権情報へのアクセス

#### 管理者（Compromised Admin）
- **能力**: 管理者権限、全システムアクセス
- **制約**: なし（最高権限）
- **典型的な攻撃**: システム全体の侵害、バックドア設置

### 攻撃目標（WHAT）

攻撃者が達成しようとする目標:

- **データ窃取**: 機密情報、個人情報、認証情報の取得
- **権限昇格**: 一般ユーザー → 管理者権限の取得
- **サービス妨害（DOS）**: システムのダウン、リソース枯渇
- **データ改ざん**: データベース、ログ、設定の不正変更
- **システム乗っ取り（RCE）**: 任意のコード実行、バックドア設置
- **金銭的利益**: 不正送金、課金回避、アカウント販売

### 攻撃ベクトル（WHERE）

攻撃の侵入点:

- **ネットワーク**: 外部API、WebSocket、公開エンドポイント
- **API**: REST API、GraphQL、gRPC
- **UI**: Webフォーム、ファイルアップロード、検索機能
- **認証**: ログイン、パスワードリセット、セッション管理
- **データベース**: SQLクエリ、NoSQLクエリ、ORM
- **ファイルシステム**: ファイル読み書き、パストラバーサル
- **外部統合**: サードパーティAPI、Webhook、OAuth

### 悪用可能性の評価

攻撃の実行難易度:

- **EASY**: 誰でも簡単に悪用可能
  - 自動ツールで検出・悪用可能
  - 認証不要
  - 特別な知識不要
  - 例: 未認証のSQLインジェクション、デフォルト認証情報

- **MEDIUM**: ある程度の知識・条件が必要
  - 認証が必要
  - カスタムスクリプト/ツールの作成が必要
  - システムの内部知識が必要
  - 例: 認証済みユーザーによる権限昇格、タイミング依存の競合状態

- **HARD**: 高度な専門知識が必要
  - 複数の条件が揃う必要あり
  - 高度なリバースエンジニアリング
  - 内部アクセス権限が必要
  - 例: 暗号の脆弱性、複雑なタイミング攻撃

---

## 適用基準

### 使用する場合

- ✅ HIGH RISKのセキュリティ問題のみ
- ✅ 認証・認可の変更
- ✅ 外部入力を扱うコード変更
- ✅ 暗号化処理の変更
- ✅ 金銭取引に関わるコード

### 使用しない場合

- ❌ LOW/MEDIUM RISKの問題（オーバーヘッドが大きい）
- ❌ UIのみの変更（バックエンドに影響なし）
- ❌ ドキュメント変更のみ

---

## 具体例

### 例1: SQLインジェクション（EASY）

**脆弱なコード**:
```python
def get_user(username):
    query = f"SELECT * FROM users WHERE username = '{username}'"
    return db.execute(query)
```

**攻撃者モデル**:
- **WHO**: 外部攻撃者（Unauthenticated）
- **WHAT**: データベース全体の窃取、管理者アカウント乗っ取り
- **WHERE**: ログインフォームのusernameパラメータ

**攻撃シナリオ**:
```http
POST /login HTTP/1.1
Content-Type: application/json

{
  "username": "admin' OR '1'='1' --",
  "password": "anything"
}
```

**結果**:
- SQLクエリが変更され認証バイパス
- 全ユーザーが返却
- 管理者アカウントでログイン可能

**悪用可能性**: EASY（自動ツールで検出・悪用可能）
**信頼度**: 10/10

---

### 例2: IDOR（MEDIUM）

**脆弱なコード**:
```python
@app.route('/api/orders/<order_id>')
@login_required
def get_order(order_id):
    order = Order.query.get(order_id)
    return jsonify(order.to_dict())
```

**攻撃者モデル**:
- **WHO**: 認証済みユーザー
- **WHAT**: 他のユーザーの注文情報（PII、購入履歴）の窃取
- **WHERE**: /api/orders/<order_id> API

**攻撃シナリオ**:
```http
# 他人の注文IDを試す（連番推測）
GET /api/orders/12346 HTTP/1.1
Authorization: Bearer <valid_token>
```

**結果**:
- 他のユーザーの注文情報が取得可能
- 注文IDを連番で試すことで全ユーザーの情報を列挙可能

**悪用可能性**: MEDIUM（認証必要、カスタムスクリプト必要）
**信頼度**: 9/10

---

## 2026年トレンド

AI生成コードの普及により、微妙なセキュリティ欠陥が増加:

- **条件分岐の順序ミス**: 認証チェックと権限チェックの順序が逆
- **不完全なバリデーション**: 一部の入力パスでバリデーションが漏れる
- **デフォルト設定の不適切な使用**: ライブラリのデフォルト設定が安全でない

具体的な攻撃シナリオを構築することで、これらの微妙な欠陥を見逃さないようにします。

---

## 関連観点

- [S01] セキュリティ脆弱性（基本）
- [S02] 一般的な脆弱性パターン
- [S05] アダプティブレビュー深度
- [S07] セキュリティリグレッション
- [S08] ブラストラジアス分析
- [S10] レッドフラグエスカレーション
